{"ast":null,"code":"import _toConsumableArray from\"/Users/mac/Desktop/Pizza 2/react-pizza-v2/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _objectSpread from\"/Users/mac/Desktop/Pizza 2/react-pizza-v2/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _asyncToGenerator from\"/Users/mac/Desktop/Pizza 2/react-pizza-v2/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _regeneratorRuntime from\"/Users/mac/Desktop/Pizza 2/react-pizza-v2/node_modules/@babel/runtime/regenerator/index.js\";import React from'react';import qs from'qs';import{useSelector}from'react-redux';import{useNavigate}from'react-router-dom';import{Categories,Sort,PizzaBlock,Skeleton,Pagination}from'../components';import{sortList}from'../components/Sort';import{useAppDispatch}from'../redux/store';import{selectFilter}from'../redux/filter/selectors';import{selectPizzaData}from'../redux/pizza/selectors';import{setCategoryId,setCurrentPage,setFilters}from'../redux/filter/slice';import{fetchPizzas}from'../redux/pizza/asyncActions';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var Home=function Home(){var navigate=useNavigate();var dispatch=useAppDispatch();var isMounted=React.useRef(false);var _useSelector=useSelector(selectPizzaData),items=_useSelector.items,status=_useSelector.status;var _useSelector2=useSelector(selectFilter),categoryId=_useSelector2.categoryId,sort=_useSelector2.sort,currentPage=_useSelector2.currentPage,searchValue=_useSelector2.searchValue;var onChangeCategory=React.useCallback(function(idx){dispatch(setCategoryId(idx));},[]);var onChangePage=function onChangePage(page){dispatch(setCurrentPage(page));};var getPizzas=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var sortBy,order,category,search;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:sortBy=sort.sortProperty.replace('-','');order=sort.sortProperty.includes('-')?'asc':'desc';category=categoryId>0?String(categoryId):'';search=searchValue;dispatch(fetchPizzas({sortBy:sortBy,order:order,category:category,search:search,currentPage:String(currentPage)}));window.scrollTo(0,0);case 6:case\"end\":return _context.stop();}}},_callee);}));return function getPizzas(){return _ref.apply(this,arguments);};}();// Если изменили параметры и был первый рендер\nReact.useEffect(function(){if(isMounted.current){var _params={categoryId:categoryId>0?categoryId:null,sortProperty:sort.sortProperty,currentPage:currentPage};var queryString=qs.stringify(_params,{skipNulls:true});navigate(\"/?\".concat(queryString));}var params=qs.parse(window.location.search.substring(1));var sortObj=sortList.find(function(obj){return obj.sortProperty===params.sortBy;});dispatch(setFilters({searchValue:params.search,categoryId:Number(params.category),currentPage:Number(params.currentPage),sort:sortObj||sortList[0]}));getPizzas();isMounted.current=true;},[categoryId,sort.sortProperty,searchValue,currentPage]);// Парсим параметры при первом рендере\n// React.useEffect(() => {\n//   if (window.location.search) {\n//     const params = qs.parse(window.location.search.substring(1)) as unknown as SearchPizzaParams;\n//     const sort = sortList.find((obj) => obj.sortProperty === params.sortBy);\n//     dispatch(\n//       setFilters({\n//         searchValue: params.search,\n//         categoryId: Number(params.category),\n//         currentPage: Number(params.currentPage),\n//         sort: sort || sortList[0],\n//       }),\n//     );\n//   }\n//   isMounted.current = true;\n// }, []);\nvar pizzas=items.map(function(obj){return/*#__PURE__*/_jsx(PizzaBlock,_objectSpread({},obj),obj.id);});var skeletons=_toConsumableArray(new Array(6)).map(function(_,index){return/*#__PURE__*/_jsx(Skeleton,{},index);});return/*#__PURE__*/_jsxs(\"div\",{className:\"container\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"content__top\",children:[/*#__PURE__*/_jsx(Categories,{value:categoryId,onChangeCategory:onChangeCategory}),/*#__PURE__*/_jsx(Sort,{value:sort})]}),/*#__PURE__*/_jsx(\"h2\",{className:\"content__title\",children:\"\\u0412\\u0441\\u0435 \\u043F\\u0438\\u0446\\u0446\\u044B\"}),status==='error'?/*#__PURE__*/_jsxs(\"div\",{className:\"content__error-info\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"\\u041F\\u0440\\u043E\\u0438\\u0437\\u043E\\u0448\\u043B\\u0430 \\u043E\\u0448\\u0438\\u0431\\u043A\\u0430 \\uD83D\\uDE15\"}),/*#__PURE__*/_jsx(\"p\",{children:\"\\u041A \\u0441\\u043E\\u0436\\u0430\\u043B\\u0435\\u043D\\u0438\\u044E, \\u043D\\u0435 \\u0443\\u0434\\u0430\\u043B\\u043E\\u0441\\u044C \\u043F\\u043E\\u043B\\u0443\\u0447\\u0438\\u0442\\u044C \\u043F\\u0438\\u0442\\u0441\\u044B. \\u041F\\u043E\\u043F\\u0440\\u043E\\u0431\\u0443\\u0439\\u0442\\u0435 \\u043F\\u043E\\u0432\\u0442\\u043E\\u0440\\u0438\\u0442\\u044C \\u043F\\u043E\\u043F\\u044B\\u0442\\u043A\\u0443 \\u043F\\u043E\\u0437\\u0436\\u0435.\"})]}):/*#__PURE__*/_jsx(\"div\",{className:\"content__items\",children:status==='loading'?skeletons:pizzas}),/*#__PURE__*/_jsx(Pagination,{currentPage:currentPage,onChangePage:onChangePage})]});};export default Home;","map":{"version":3,"sources":["/Users/mac/Desktop/Pizza 2/react-pizza-v2/src/pages/Home.tsx"],"names":["React","qs","useSelector","useNavigate","Categories","Sort","PizzaBlock","Skeleton","Pagination","sortList","useAppDispatch","selectFilter","selectPizzaData","setCategoryId","setCurrentPage","setFilters","fetchPizzas","Home","navigate","dispatch","isMounted","useRef","items","status","categoryId","sort","currentPage","searchValue","onChangeCategory","useCallback","idx","onChangePage","page","getPizzas","sortBy","sortProperty","replace","order","includes","category","String","search","window","scrollTo","useEffect","current","params","queryString","stringify","skipNulls","parse","location","substring","sortObj","find","obj","Number","pizzas","map","id","skeletons","Array","_","index"],"mappings":"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","sourcesContent":["import React from 'react';\nimport qs from 'qs';\nimport { useSelector } from 'react-redux';\nimport { useNavigate } from 'react-router-dom';\n\nimport { Categories, Sort, PizzaBlock, Skeleton, Pagination } from '../components';\n\nimport { sortList } from '../components/Sort';\n\nimport { useAppDispatch } from '../redux/store';\nimport { selectFilter } from '../redux/filter/selectors';\nimport { selectPizzaData } from '../redux/pizza/selectors';\nimport { setCategoryId, setCurrentPage, setFilters } from '../redux/filter/slice';\nimport { fetchPizzas } from '../redux/pizza/asyncActions';\nimport { SearchPizzaParams } from '../redux/pizza/types';\n\nconst Home: React.FC = () => {\n  const navigate = useNavigate();\n  const dispatch = useAppDispatch();\n  const isMounted = React.useRef(false);\n\n  const { items, status } = useSelector(selectPizzaData);\n  const { categoryId, sort, currentPage, searchValue } = useSelector(selectFilter);\n\n  const onChangeCategory = React.useCallback((idx: number) => {\n    dispatch(setCategoryId(idx));\n  }, []);\n\n  const onChangePage = (page: number) => {\n    dispatch(setCurrentPage(page));\n  };\n\n  const getPizzas = async () => {\n    const sortBy = sort.sortProperty.replace('-', '');\n    const order = sort.sortProperty.includes('-') ? 'asc' : 'desc';\n    const category = categoryId > 0 ? String(categoryId) : '';\n    const search = searchValue;\n\n    dispatch(\n      fetchPizzas({\n        sortBy,\n        order,\n        category,\n        search,\n        currentPage: String(currentPage),\n      }),\n    );\n\n    window.scrollTo(0, 0);\n  };\n\n  // Если изменили параметры и был первый рендер\n  React.useEffect(() => {\n    if (isMounted.current) {\n      const params = {\n        categoryId: categoryId > 0 ? categoryId : null,\n        sortProperty: sort.sortProperty,\n        currentPage,\n      };\n\n      const queryString = qs.stringify(params, { skipNulls: true });\n\n      navigate(`/?${queryString}`);\n    }\n\n    const params = qs.parse(window.location.search.substring(1)) as unknown as SearchPizzaParams;\n    const sortObj = sortList.find((obj) => obj.sortProperty === params.sortBy);\n    dispatch(\n      setFilters({\n        searchValue: params.search,\n        categoryId: Number(params.category),\n        currentPage: Number(params.currentPage),\n        sort: sortObj || sortList[0],\n      }),\n    );\n\n    getPizzas();\n    isMounted.current = true;\n  }, [categoryId, sort.sortProperty, searchValue, currentPage]);\n\n  // Парсим параметры при первом рендере\n  // React.useEffect(() => {\n  //   if (window.location.search) {\n  //     const params = qs.parse(window.location.search.substring(1)) as unknown as SearchPizzaParams;\n  //     const sort = sortList.find((obj) => obj.sortProperty === params.sortBy);\n  //     dispatch(\n  //       setFilters({\n  //         searchValue: params.search,\n  //         categoryId: Number(params.category),\n  //         currentPage: Number(params.currentPage),\n  //         sort: sort || sortList[0],\n  //       }),\n  //     );\n  //   }\n  //   isMounted.current = true;\n  // }, []);\n\n  const pizzas = items.map((obj: any) => <PizzaBlock key={obj.id} {...obj} />);\n  const skeletons = [...new Array(6)].map((_, index) => <Skeleton key={index} />);\n\n  return (\n    <div className=\"container\">\n      <div className=\"content__top\">\n        <Categories value={categoryId} onChangeCategory={onChangeCategory} />\n        <Sort value={sort} />\n      </div>\n      <h2 className=\"content__title\">Все пиццы</h2>\n      {status === 'error' ? (\n        <div className=\"content__error-info\">\n          <h2>Произошла ошибка 😕</h2>\n          <p>К сожалению, не удалось получить питсы. Попробуйте повторить попытку позже.</p>\n        </div>\n      ) : (\n        <div className=\"content__items\">{status === 'loading' ? skeletons : pizzas}</div>\n      )}\n\n      <Pagination currentPage={currentPage} onChangePage={onChangePage} />\n    </div>\n  );\n};\n\nexport default Home;\n"]},"metadata":{},"sourceType":"module"}